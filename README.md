# Tropical and Sub-Tropical Flood and Water Masks

This repository includes code to generate 10 m spatial resolution flood and water masks that can be used to develop a machine learning model to classify flooding in satellite images. 

The flood and water masks are generated by combining various datasets including [ESA WorldCover 10m v100](https://developers.google.com/earth-engine/datasets/catalog/ESA_WorldCover_v100) and vector flood and water layers from the [Copernicus Emergency Management System (EMS)](https://emergency.copernicus.eu/mapping/list-of-activations-rapid) Rapid Mapping Activation events.

In total, 513 flood and water mask layers were generated as GeoTIFF files with a 10 m spatial resolution. Each of these layers corresponds to a flood event and date (there can be many flood mask layers per-event which represent flooding on different days as the event evolves). Flood and water masks were generated for 65 flood events since 2018 in 26 countries spanning the tropics and sub-tropics.

Each flood and water mask is a raster image dataset where pixel values correspond to the following classes:

* 0: land and not flooded
* 1: flooding (rasterised from the observed events layers in the EMS Rapid Mapping Activation data)
* 2: permanent water (determined by the water class in the ESA WorldCover 10m v100 product or hydrography layers in the EMS Rapid Mapping Activation data)

Each flood and water mask as three dates associated with it:

* activation date: the date of the activation in the EMS Rapid Mapping Activation system.
* event date: the initial date of the flood event (this can be before the activation date).
* satellite date: the date of the latest input images and data used to generate the observed event data in EMS Rapid Mapping Activation. 

This dataset was generated through a project funded by the Climate Change AI Innovation Grants Program. 

## Overview

#### 00-download-ems-vectors.py

Downloads the latest version of vector products for all available flood events in tropical and sub-tropical countries sourced from the [Copernicus Emergency Management System (EMS)](https://emergency.copernicus.eu/mapping/list-of-activations-rapid). Using the [ml4floods](https://ai4eo.esa.int/ML4Floods/notebooks/ML4Floods.ipynb) vector flood and water maps and metadata are generated.

#### 01-download-images.py

Downloads permanent water layer from [European Commission's Joint Research Centre (JRC)](https://global-surface-water.appspot.com/) and land cover from the [European Space Agency (ESA) WorldCover 10m v100 product](https://esa-worldcover.org/en/data-access) corresponding to each EMS activation event from Google Earth Engine (GEE). The script uses Area of Interest (AOI) from the metadata file and the activation date from the Copernicus EMS table to ensure downloaded data is spatially and temporally aligned to each EMS Rapid Mapping Activation event. 

Note, the data is downloaded from GEE to a Google Cloud Storage bucket. This script should be run when authenticated to GEE and setting the `gcs_bucket` variable to a Google Cloud Storage bucket name.

#### 02-get-event-dates.py

Obtains the actual date of the flood events from the [Copernicus event information page](https://emergency.copernicus.eu/mapping/list-of-activations-rapid). The actual event date allows for accurate retrieval of pre-event images if required for subsequent machine learning and flood classification tasks.

#### 03-merge-images.py

Merges the static images that were downloaded from GEE for each event in `01-downlaod-images.py` into one raster image using `gdal_merge`. This is necessary because some images from GEE are split during download. The script also generates a metadata table that contains the event date, the activation date and the satellite date (the date of the latest input images and data used to generate the observed event data in EMS Rapid Mapping Activation) for each image associated with an EMS Rapid Mapping Activation event.

#### 04-generate-flood-water-masks.py

Rasterises the flood and hydrography vector product generated for each EMS Rapid Mapping Activation event and combines this data with land and permanent water classes derived from the ESA WorldCover 10m v100 product.   



